<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Almira Luxury - Diamond Collector Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #f9f9f9, #fff);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      justify-content: center;
    }
    #characterSelect {
      text-align: center;
      margin-bottom: 20px;
    }
    #characterSelect h2 {
      color: #6a00b7;
      margin-bottom: 15px;
    }
    .charOption {
      display: inline-block;
      margin: 0 20px;
      cursor: pointer;
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(106, 0, 183, 0.3);
      transition: transform 0.2s ease;
      user-select: none;
    }
    .charOption:hover {
      transform: scale(1.1);
      border-color: #6a00b7;
    }
    .charOption span {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #6a00b7;
    }
    canvas {
      border: 3px solid #a051f2;
      border-radius: 15px;
      background: #f0e6ff;
      display: none;
    }
    #instructions {
      margin-top: 10px;
      font-size: 16px;
      color: #333;
      user-select: none;
      display: none;
    }
    #popupOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #popupBox {
      background: white;
      border-radius: 15px;
      padding: 30px;
      width: 300px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(106,0,183,0.5);
    }
    #popupBox button {
      margin: 10px;
      padding: 10px 20px;
      border-radius: 50px;
      border: none;
      background: #6a00b7;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #popupBox button:hover {
      background: #a051f2;
    }
    #shop {
      display: none;
      margin-top: 20px;
      text-align: center;
      max-width: 400px;
      background: #f3eaff;
      border: 3px solid #a051f2;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 15px #a051f2aa;
    }
    #shop h2 {
      color: #6a00b7;
      margin-bottom: 15px;
    }
    .shop-item {
      background: white;
      border-radius: 15px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 0 10px #6a00b7aa;
      cursor: pointer;
      transition: transform 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shop-item:hover {
      transform: scale(1.05);
    }
    .shop-item span {
      font-weight: bold;
      color: #6a00b7;
    }
  </style>
</head>
<body>

  <div id="characterSelect">
    <h2>Select Your Character</h2>
    <div class="charOption" data-char="female">
      <svg width="80" height="100" viewBox="0 0 80 100">
        <circle cx="40" cy="30" r="15" fill="#f48fb1"/>
        <rect x="30" y="50" width="20" height="35" fill="#ba68c8" rx="8"/>
        <rect x="50" y="60" width="15" height="20" fill="#ff6f91" rx="4"/>
        <line x1="50" y1="60" x2="65" y2="60" stroke="#c94f70" stroke-width="2"/>
      </svg>
      <span>Almira (Female)</span>
    </div>
    <div class="charOption" data-char="male">
      <svg width="80" height="100" viewBox="0 0 80 100">
        <circle cx="40" cy="30" r="15" fill="#90caf9"/>
        <rect x="30" y="50" width="20" height="35" fill="#42a5f5" rx="8"/>
        <rect x="50" y="60" width="15" height="20" fill="#4fc3f7" rx="4"/>
        <line x1="50" y1="60" x2="65" y2="60" stroke="#2e86c1" stroke-width="2"/>
      </svg>
      <span>Alex (Male)</span>
    </div>
  </div>

  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="instructions">Press SPACE to jump. Collect 10 diamonds to shop!</div>

  <div id="popupOverlay">
    <div id="popupBox">
      <p>You collected 10 diamonds! Ready to shop?</p>
      <button id="btnShop">Shop Now</button>
      <button id="btnContinue">Keep Collecting</button>
    </div>
  </div>

  <div id="shop">
    <h2>Almira Luxury Shop</h2>
    <div class="shop-item" data-price="5">
      <span>Luxury Handbag</span> <button class="buy-btn">Buy (5 diamonds)</button>
    </div>
    <div class="shop-item" data-price="3">
      <span>Stylish Sunglasses</span> <button class="buy-btn">Buy (3 diamonds)</button>
    </div>
    <div class="shop-item" data-price="7">
      <span>Elegant Dress</span> <button class="buy-btn">Buy (7 diamonds)</button>
    </div>
    <div class="shop-item" data-price="2">
      <span>Fashion Scarf</span> <button class="buy-btn">Buy (2 diamonds)</button>
    </div>
    <p id="shopMessage" style="color:#6a00b7; font-weight:bold; margin-top:15px;"></p>
  </div>

<script>
  const characterSelect = document.getElementById('characterSelect');
  const gameCanvas = document.getElementById('gameCanvas');
  const ctx = gameCanvas.getContext('2d');
  const instructions = document.getElementById('instructions');
  const popupOverlay = document.getElementById('popupOverlay');
  const btnShop = document.getElementById('btnShop');
  const btnContinue = document.getElementById('btnContinue');
  const shop = document.getElementById('shop');
  const shopMessage = document.getElementById('shopMessage');

  let selectedCharacter = null;
  let diamondsCollected = 0;
  let gameRunning = false;

  // Player properties
  const player = {
    x: 100,
    y: 0,
    width: 60,
    height: 100,
    dy: 0,
    gravity: 1,
    jumpForce: -18,
    grounded: false,
    animationFrame: 0,
    animationSpeed: 6,
    animationCounter: 0,
    character: 'female',
  };

  const groundY = gameCanvas.height - 80;

  // Obstacles and diamonds arrays
  let obstacles = [];
  let diamonds = [];

  // Speed and spawn intervals
  let speed = 6;
  let obstacleTimer = 0;
  let diamondTimer = 0;

  // Initialize game elements after start
  function initGame() {
    diamondsCollected = 0;
    obstacles = [];
    diamonds = [];
    player.x = 100;
    player.y = groundY - player.height;
    player.dy = 0;
    player.grounded = true;
    player.animationFrame = 0;
    player.animationCounter = 0;
    speed = 6;
    obstacleTimer = 0;
    diamondTimer = 0;
    shop.style.display = 'none';
    shopMessage.textContent = '';
  }

  // Draw player function (same as before)
  function drawPlayer() {
    const p = player;

    ctx.save();
    ctx.translate(p.x, p.y);

    // Body
    ctx.fillStyle = p.character === 'female' ? '#ba68c8' : '#42a5f5';
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect(0, 30, p.width, 70, 15);
    ctx.fill();
    ctx.stroke();

    // Head
    ctx.beginPath();
    ctx.fillStyle = p.character === 'female' ? '#f48fb1' : '#90caf9';
    ctx.arc(p.width / 2, 15, 25, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // Legs swinging
    const legSwing = Math.sin(p.animationFrame * 0.3) * 10;
    ctx.lineWidth = 8;
    ctx.strokeStyle = '#333';

    // Left leg
    ctx.beginPath();
    ctx.moveTo(15, 100);
    ctx.lineTo(15 + legSwing, 140);
    ctx.stroke();

    // Right leg
    ctx.beginPath();
    ctx.moveTo(p.width - 15, 100);
    ctx.lineTo(p.width - 15 - legSwing, 140);
    ctx.stroke();

    // Arms + bag swinging
    const armSwing = Math.sin(p.animationFrame * 0.3 + Math.PI) * 10;

    // Left arm
    ctx.beginPath();
    ctx.lineWidth = 7;
    ctx.moveTo(10, 50);
    ctx.lineTo(10 + armSwing, 90);
    ctx.stroke();

    // Right arm holding bag (rectangle)
    ctx.beginPath();
    ctx.lineWidth = 7;
    ctx.moveTo(p.width - 10, 50);
    ctx.lineTo(p.width - 10 + armSwing, 90);
    ctx.stroke();

    // Bag swinging
    const bagX = p.width - 25 + armSwing;
    const bagY = 85 + Math.abs(armSwing) * 0.3;
    ctx.fillStyle = p.character === 'female' ? '#ff6f91' : '#4fc3f7';
    ctx.strokeStyle = p.character === 'female' ? '#c94f70' : '#2e86c1';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect(bagX, bagY, 25, 35, 8);
    ctx.fill();
    ctx.stroke();

    // Bag handles
    ctx.beginPath();
    ctx.moveTo(bagX, bagY);
    ctx.lineTo(bagX + 25, bagY);
    ctx.stroke();

    ctx.restore();
  }

  // Draw obstacles (red boxes)
  function drawObstacles() {
    ctx.fillStyle = '#d32f2f';
    obstacles.forEach(obs => {
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    });
  }

  // Draw diamonds (blue diamond shape)
  function drawDiamonds() {
    ctx.fillStyle = '#29b6f6';
    diamonds.forEach(d => {
      const cx = d.x + d.size / 2;
      const cy = d.y + d.size / 2;
      const size = d.size;
      ctx.beginPath();
      ctx.moveTo(cx, cy - size / 2);
      ctx.lineTo(cx + size / 2, cy);
      ctx.lineTo(cx, cy + size / 2);
      ctx.lineTo(cx - size / 2, cy);
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = '#0288d1';
      ctx.lineWidth = 2;
      ctx.stroke();
    });
  }

  // Update game elements positions
  function updateGameElements() {
    // Move obstacles to left
    obstacles.forEach(obs => {
      obs.x -= speed;
    });
    obstacles = obstacles.filter(obs => obs.x + obs.width > 0);

    // Move diamonds to left
    diamonds.forEach(d => {
      d.x -= speed;
    });
    diamonds = diamonds.filter(d => d.x + d.size > 0);
  }

  // Spawn obstacles randomly every ~1.5-2.5s
  function trySpawnObstacle() {
    obstacleTimer++;
    if (obstacleTimer > 90 + Math.random() * 60) {
      obstacleTimer = 0;
      obstacles.push({
        x: gameCanvas.width,
        y: groundY - 40,
        width: 40,
        height: 40,
      });
    }
  }

  // Spawn diamonds randomly every ~1-1.5s
  function trySpawnDiamond() {
    diamondTimer++;
    if (diamondTimer > 60 + Math.random() * 30) {
      diamondTimer = 0;
      diamonds.push({
        x: gameCanvas.width,
        y: groundY - 90 - Math.random() * 50, // floating above ground
        size: 25,
      });
    }
  }

  // Collision detection helper
  function isColliding(a, b) {
    return (
      a.x < b.x + b.width &&
      a.x + a.width > b.x &&
      a.y < b.y + b.height &&
      a.y + a.height > b.y
    );
  }

  // Collision for diamonds (since diamond is diamond shape, approx with square)
  function isCollidingDiamond(playerRect, diamond) {
    return (
      playerRect.x < diamond.x + diamond.size &&
      playerRect.x + playerRect.width > diamond.x &&
      playerRect.y < diamond.y + diamond.size &&
      playerRect.y + playerRect.height > diamond.y
    );
  }

  // Show popup
  function showPopup() {
    popupOverlay.style.display = 'flex';
  }
  // Hide popup
  function hidePopup() {
    popupOverlay.style.display = 'none';
  }

  // Show shop
  function showShop() {
    shop.style.display = 'block';
  }
  // Hide shop
  function hideShop() {
    shop.style.display = 'none';
  }

  // Game over / restart (for now no game over, just reset obstacles)
  function gameOver() {
    initGame();
  }

  // Main game loop
  function gameLoop() {
    if (!gameRunning) return;
    ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);

    // Draw ground
    ctx.fillStyle = '#c39bd3';
    ctx.fillRect(0, groundY, gameCanvas.width, 80);

    // Player physics
    player.dy += player.gravity;
    player.y += player.dy;
    if (player.y > groundY - player.height) {
      player.y = groundY - player.height;
      player.dy = 0;
      player.grounded = true;
    }

    // Animate player running
    player.animationCounter++;
    if (player.animationCounter >= player.animationSpeed) {
      player.animationCounter = 0;
      player.animationFrame++;
    }

    // Update obstacles & diamonds
    updateGameElements();
    trySpawnObstacle();
    trySpawnDiamond();

    // Draw elements
    drawPlayer();
    drawObstacles();
    drawDiamonds();

    // Check collisions with obstacles (lose diamond or reset diamonds)
    const playerRect = {
      x: player.x,
      y: player.y,
      width: player.width,
      height: player.height,
    };
    for (let i = 0; i < obstacles.length; i++) {
      if (isColliding(playerRect, obstacles[i])) {
        // Hit obstacle, lose 1 diamond if any
        if (diamondsCollected > 0) {
          diamondsCollected--;
        }
        // Remove this obstacle so not repeat penalty immediately
        obstacles.splice(i, 1);
        break;
      }
    }

    // Check collisions with diamonds (collect)
    for (let i = 0; i < diamonds.length; i++) {
      if (isCollidingDiamond(playerRect, diamonds[i])) {
        diamondsCollected++;
        diamonds.splice(i, 1);
        break;
      }
    }

    // Draw diamond count UI
    ctx.fillStyle = '#6a00b7';
    ctx.font = '20px Segoe UI';
    ctx.fillText(`Diamonds: ${diamondsCollected}`, 20, 30);

    // Check if collected 10 diamonds
    if (diamondsCollected >= 10) {
      gameRunning = false;
      showPopup();
    }

    requestAnimationFrame(gameLoop);
  }

  // Player jump
  function playerJump() {
    if (player.grounded) {
      player.dy = player.jumpForce;
      player.grounded = false;
    }
  }

  // Controls
  window.addEventListener('keydown', e => {
    if (e.code === 'Space' && gameRunning) {
      playerJump();
    }
  });

  // Character selection
  document.querySelectorAll('.charOption').forEach(option => {
    option.addEventListener('click', () => {
      selectedCharacter = option.getAttribute('data-char');
      player.character = selectedCharacter;
      characterSelect.style.display = 'none';
      gameCanvas.style.display = 'block';
      instructions.style.display = 'block';
      initGame();
      gameRunning = true;
      gameLoop();
    });
  });

  // Popup buttons
  btnShop.addEventListener('click', () => {
    hidePopup();
    showShop();
  });
  btnContinue.addEventListener('click', () => {
    hidePopup();
    diamondsCollected = 0; // reset count to collect again
    gameRunning = true;
    gameLoop();
  });

  // Shop buy buttons
  shop.querySelectorAll('.buy-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      const itemDiv = e.target.parentElement;
      const price = parseInt(itemDiv.getAttribute('data-price'));
      if (diamondsCollected >= price) {
        diamondsCollected -= price;
        shopMessage.textContent = `You bought: ${itemDiv.querySelector('span').textContent}! Diamonds left: ${diamondsCollected}`;
      } else {
        shopMessage.textContent = 'Not enough diamonds!';
      }
    });
  });
</script>
</body>
</html>
